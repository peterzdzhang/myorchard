@model ADLIndexViewModel
@using Faurecia.ADL.ViewModels;
@{
    Script.Require("echarts");
    Script.Require("echarts.theme");
    Script.Require("Microsoft_jQueryAjax_Validate");
    Script.Require("jquery_form");
    Response.Cache.SetCacheability(System.Web.HttpCacheability.NoCache);
    string returnUrl = Request["ReturnUrl"];
}
<h1 style="margin:5px 10px 10px 10px">
    @Html.TitleForPage(T("Compare Cost").ToString())
</h1>

<div class="panel panel-default">
    <div class="panel-heading">
        <div class="row">
            <div class="col-lg-6 col-sm-6 col-xs-6">
            @using (Html.BeginForm("UploadFile", "CostCompare", null, FormMethod.Post,
                                    new { @class = "form-horizontal", resource = "form", id = "frmUploadFile", enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                <div class="input-group">
                    <input type="file" id="CostFile" name="CostFile" class="form-control">
                    <span class="input-group-btn">
                        <button type="submit" name="Upload" class="btn btn-success">@T("Upload")</button>
                    </span>
                </div>
            }
            </div>
            <div class="col-lg-6 col-sm-6 col-xs-6 text-right">
                @if (!string.IsNullOrEmpty(returnUrl))
            {
                    @Html.Link(T("Back").Text, returnUrl, new { @class = "btn btn-default  btn-sm" });
            }
            </div>
        </div>
    </div>
 
    <div class="panel-body">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-lg-12" id="chartContainer">
                <div id="chart" style="width:1000px;height:400px;"></div>
            </div>
        </div>
        <table id="chartData" class="table table-condensed table-bordered"  style="width:auto;">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>
</div>
@using (Script.Foot())
{
    <script type="text/javascript">
        var myChart;
        $(function () {

            $("#frmUploadFile").ajaxForm({
                beforeSend: beginSave,
                success: completeSave,
                error: completeSave
            });
            var width = $("#chartContainer").width();
            $("#chart").width(width);
            // 基于准备好的dom，初始化echarts实例
            myChart = echarts.init($("#chart")[0]);

            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: ''
                },
                tooltip: {},
                legend: {
                    data: []
                },
                xAxis: {
                    data: []
                },
                yAxis: {},
                series: []
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
            refreshChart();

        });

        function beginSave() {
            $("#btnUpload").attr("disabled", "disabled");
        }

        function completeSave(result) {
            if (result.Code > 0) {
                alert(result.Message);
            }
            else {
                alert(result.Message);
                refreshChart();
            }
        }

        function refreshChart() {
            var ids = "@Request["ids"]";
            var url="@Url.Action("GetData", "CostCompare", new { Area= "Faurecia.ADL" })";
            url = url + "?ids=" + ids;
            // 异步加载数据
            $.get(url,null,function (data) {
                // 填入数据
                myChart.setOption({
                    xAxis: {
                        data: data.Categories
                    },
                    legend: {
                        data: data.Legend
                    },
                    series: data.Series
                });

                var table = $("#chartData");
                var thead = $(table).find("thead");
                thead.empty();
                var tr = $("<tr></tr>");
                var th = $("<th></th>");
                tr.append(th);
                for (var i = 0; i < data.Series.length; i++) {
                    th = $("<th></th>");
                    th.text(data.Series[i].name);
                    tr.append(th);
                }
                thead.append(tr);



                var tbody = $(table).find("tbody");
                tbody.empty();
                for (var i = 0; i < data.Categories.length; i++) {
                    var tr = $("<tr></tr>");
                    var td = $("<td></td>");
                    td.text(data.Categories[i]);
                    tr.append(td);

                    for (var j = 0; j < data.Series.length; j++) {
                        var td = $("<td></td>");
                        td.text( data.Series[j].data[i]);
                        tr.append(td);
                    }
                    tbody.append(tr);
                }
            });
        }
    </script>
}